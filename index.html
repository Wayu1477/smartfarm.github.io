<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Farm</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            border-radius: 15px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
        }
        .status-on {
            color: green;
            font-weight: bold;
        }
        .status-off {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container mt-4">
        <h1 class="text-center">üå± Smart Farm üíß</h1>

        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card text-center p-3">
                    <h4>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h4>
                    <p id="date"></p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center p-3">
                    <h4>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤</h4>
                    <p id="time"></p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center p-3">
                    <h4>üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</h4>
                    <p id="temperature">- ¬∞C</p>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-4">
                <div class="card text-center p-3">
                    <h4>üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</h4>
                    <p id="humidity">- %</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center p-3">
                    <h4>üö∞ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏î‡∏ô‡πâ‡∏≥</h4>
                    <p id="pump-status" class="status-off">‡∏õ‡∏¥‡∏î</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center p-3">
                    <h4>üí° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü</h4>
                    <p id="light-status" class="status-off">‡∏õ‡∏¥‡∏î</p>
                </div>
            </div>
        </div>

        <h3 class="mt-4">üìú ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏î‡∏ô‡πâ‡∏≥</h3>
        <table class="table table-bordered mt-2">
            <thead class="table-dark">
                <tr>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                    <th>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</th>
                    <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏î‡∏ô‡πâ‡∏≥</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü</th>
                </tr>
            </thead>
            <tbody id="logTable"></tbody>
        </table>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ -->
        <button class="btn btn-danger mt-3" onclick="resetHistory()">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
    </div>

    <script>
        function updateDateTime() {
            const now = new Date();
            document.getElementById("date").innerText = now.toLocaleDateString("th-TH");
            document.getElementById("time").innerText = now.toLocaleTimeString("th-TH");
        }

        function fetchData() {
            fetch("get_log.php")
                .then(response => response.json())
                .then(data => {
                    let table = document.getElementById("logTable");
                    table.innerHTML = "";
                    data.forEach(row => {
                        let pumpStatus = row.pump === "on" ? `<span class='status-on'>‡πÄ‡∏õ‡∏¥‡∏î</span>` : `<span class='status-off'>‡∏õ‡∏¥‡∏î</span>`;
                        let lightStatus = row.light === "on" ? `<span class='status-on'>‡πÄ‡∏õ‡∏¥‡∏î</span>` : `<span class='status-off'>‡∏õ‡∏¥‡∏î</span>`;
                        table.innerHTML += `<tr>
                            <td>${row.date}</td>
                            <td>${row.time}</td>
                            <td>${row.temp}¬∞C</td>
                            <td>${row.humidity}%</td>
                            <td>${pumpStatus}</td>
                            <td>${lightStatus}</td>
                        </tr>`;

                        document.getElementById("temperature").innerText = row.temp + "¬∞C";
                        document.getElementById("humidity").innerText = row.humidity + "%";
                        document.getElementById("pump-status").innerHTML = pumpStatus;
                        document.getElementById("light-status").innerHTML = lightStatus;
                    });
                });
        }

        function resetHistory() {
            if (confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
                fetch("reset_log.php", { method: "POST" })
                    .then(response => response.text())
                    .then(data => {
                        alert(data);
                        fetchData(); 
                    });
            }
        }

        setInterval(updateDateTime, 500);
        setInterval(fetchData, 5000);
        updateDateTime();
        fetchData();
    </script>
</body>
</html>